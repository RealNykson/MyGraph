<UserControl
    x:Class="MyGraph.Views.Node"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:MyGraph.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:MyGraph.ViewModels"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <Grid>
        <StackPanel
            x:Name="NodeBody"
            MouseEnter="NodeBody_MouseEnter"
            MouseLeave="NodeBody_MouseLeave"
            Orientation="Horizontal">
            <Border
                Width="{Binding Width}"
                Height="{Binding Height}"
                Background="{DynamicResource NodeBackground}"
                BorderThickness="1.5"
                CornerRadius="4"
                MouseDown="Grid_MouseDown">
                <Border.Style>
                    <Style TargetType="Border">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="BorderBrush" Value="{DynamicResource NodeBorderHover}" />
                            </Trigger>
                            <DataTrigger Binding="{Binding IsSelected}" Value="true">
                                <Setter Property="BorderBrush" Value="{DynamicResource NodeBorderSelected}" />
                            </DataTrigger>

                        </Style.Triggers>
                        <Setter Property="BorderBrush" Value="{DynamicResource NodeBorder}" />
                    </Style>
                </Border.Style>
                <Grid>
                    <TextBlock
                        Padding="15,15,15,15"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontFamily="Inter"
                        FontSize="18"
                        Foreground="{DynamicResource NodeText}"
                        Text="{Binding name}"
                        TextAlignment="Center"
                        TextWrapping="Wrap" />
                    <ItemsControl
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        ItemsSource="{Binding Outputs}">
                        <ItemsControl.ItemContainerStyle>
                            <Style>
                                <Setter Property="FrameworkElement.Margin" Value="6" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <ItemContainerTemplate>
                                <Ellipse
                                    Width="10"
                                    Height="10"
                                    Margin="0,0,-14,0"
                                    Fill="{DynamicResource OutputBackground}"
                                    Stroke="{DynamicResource OutputBorder}" />
                            </ItemContainerTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <ItemsControl
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        ItemsSource="{Binding Inputs}">
                        <ItemsControl.ItemContainerStyle>
                            <Style>
                                <Setter Property="FrameworkElement.Margin" Value="5" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>

                            <ItemContainerTemplate>
                                <Rectangle
                                    x:Name="ConnectorShape1"
                                    Width="7"
                                    Height="14"
                                    Margin="-12,0,0,0"
                                    Fill="{DynamicResource InputBackground}"
                                    IsHitTestVisible="False"
                                    RadiusX="2"
                                    RadiusY="2"
                                    Stroke="{DynamicResource InputBorder}"
                                    StrokeThickness="1" />

                            </ItemContainerTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                </Grid>

            </Border>
            <Grid HorizontalAlignment="Stretch" Background="Transparent">
                <Button
                    x:Name="AddNodeButton"
                    Width="30"
                    Height="30"
                    Margin="10,0,10,0"
                    Padding="0"
                    BorderThickness="0"
                    Command="{Binding AddGhostOutputCommand}"
                    Cursor="Hand"
                    IsEnabled="True">
                    <Button.Style>
                        <Style BasedOn="{StaticResource IconButton}" TargetType="Button">
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding IsMouseOver, ElementName=NodeBody}" Value="True" />
                                        <Condition Binding="{Binding Canvas.GhostConnection, TargetNullValue=null}" Value="null" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                            <Setter Property="Visibility" Value="Collapsed" />
                        </Style>
                    </Button.Style>

                    <Button.Content>
                        <Path
                            xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                            Data="M10,7 A1,1 0 1,1 8,7 A1,1 0 1,1 10,7              M4,20 A1,1 0 1,1 2,20 A1,1 0 1,1 4,20             M4.7,19.3 L19,5              M21,3 L18,4 L20,6 Z             M9.26,7.68 L5,12 L7,17             M10,14 L15,16 L18.5,12.5             M18,12 L19,11 L20,12 L19,13 Z"
                            StrokeLineJoin="Round"
                            StrokeThickness="2">
                            <Path.LayoutTransform>
                                <RotateTransform Angle="45" />
                            </Path.LayoutTransform>
                            <Path.Style>
                                <Style TargetType="Path">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsMouseOver, ElementName=AddNodeButton}" Value="True">
                                            <Setter Property="Stroke" Value="{DynamicResource NodeAddOutputHover}" />
                                        </DataTrigger>
                                    </Style.Triggers>

                                    <Setter Property="Stroke" Value="{DynamicResource NodeAddOutput}" />
                                </Style>
                            </Path.Style>
                        </Path>
                    </Button.Content>
                </Button>
            </Grid>

        </StackPanel>
    </Grid>
</UserControl>
